<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Painel Admin</title>
<style>
body{background:#111;color:#fff;font-family:Arial;padding:20px}
input,button{padding:10px;margin:5px}
.user{border:1px solid #444;padding:10px;margin:10px}
.online{color:lime}
.offline{color:red}
pre{background:#000;padding:10px;overflow:auto}
#loginBox{max-width:400px;margin:auto;text-align:center;}
#panel{display:none;}
</style>
</head>

<body>

<div id="loginBox">
  <h1>Login Administrador</h1>
  <input type="password" id="adminPass" placeholder="Digite a senha do admin" />
  <button id="loginBtn">Entrar</button>
  <p id="msg" style="color:red;"></p>
</div>

<div id="panel">
  <h1>Painel Administrador</h1>
  <div id="users">Carregando...</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getDatabase, ref, onValue, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

// === CONFIGURAﾃﾃグ FIREBASE ===
const firebaseConfig = {
  apiKey: "AIzaSyDon4WbCbe4kCkUq-OdLBRhzhMaUObbAfo",
  authDomain: "html-15e80.firebaseapp.com",
  databaseURL: "https://html-15e80-default-rtdb.firebaseio.com",
  projectId: "html-15e80",
  storageBucket: "html-15e80.firebasestorage.app",
  appId: "1:1068148640439:web:7cc5bde34f4c5a5ce41b32"
};

const ADMIN_EMAIL = "administrador1@codehub.ct.ws";

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

const loginBtn = document.getElementById("loginBtn");
const adminPass = document.getElementById("adminPass");
const msg = document.getElementById("msg");
const loginBox = document.getElementById("loginBox");
const panel = document.getElementById("panel");
const usersDiv = document.getElementById("users");

// === LOGIN ===
loginBtn.addEventListener("click", ()=>{
  const senha = adminPass.value.trim();
  if(!senha){ msg.innerText="Digite a senha!"; return; }

  signInWithEmailAndPassword(auth, ADMIN_EMAIL, senha)
  .then(()=>{
    loginBox.style.display = "none";
    panel.style.display = "block";
    iniciarPainel();
    iniciarOneSignal();
  })
  .catch(err=>{
    msg.innerText = "Senha incorreta ou erro no login.";
  });
});

// === FUNﾃﾃグ PAINEL ===
function iniciarPainel(){
  onAuthStateChanged(auth, user=>{
    if(!user || user.email !== ADMIN_EMAIL){
      panel.innerHTML="<h2>Acesso negado</h2>";
      return;
    }

    onValue(ref(db,"users"), snap=>{
      const users = snap.val() || {};
      usersDiv.innerHTML="";
      Object.entries(users).forEach(([uid,u])=>{
        const div = document.createElement("div");
        div.className="user";
        div.innerHTML = `
          <b>${u.email||uid}</b><br>
          ${u.online?"泙 Online":"閥 Offline"}<br>
          Banido: ${u.ban?.active?"SIM":"Nﾃグ"}<br>
          <button onclick="ban('${uid}',1)">Ban 1 dia</button>
          <button onclick="ban('${uid}',7)">Ban 7 dias</button>
          <button onclick="unban('${uid}')">Desbanir</button>
          <details>
            <summary>Storage</summary>
            <pre>${JSON.stringify(u.storage,null,2)}</pre>
          </details>
        `;
        usersDiv.appendChild(div);
      });
    });
  });

  window.ban = (uid,days)=>{
    update(ref(db,"users/"+uid+"/ban"),{
      active:true,
      until: Date.now()+days*24*60*60*1000,
      reason:`Banido por ${days} dia(s)`
    });
  };

  window.unban = (uid)=>{
    update(ref(db,"users/"+uid+"/ban"),{
      active:false,
      until:null,
      reason:null
    });
  };
}

// === FUNﾃﾃグ ONESIGNAL ===
function iniciarOneSignal(){
  const script = document.createElement("script");
  script.src = "https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js";
  script.defer = true;
  document.head.appendChild(script);

  script.onload = ()=>{
    window.OneSignalDeferred = window.OneSignalDeferred || [];
    OneSignalDeferred.push(async function(OneSignal){
      await OneSignal.init({
        appId:"fb589e2f-83e6-4111-a14b-2b03212fed8a",
        safari_web_id:"web.onesignal.auto.3a869b75-1942-4792-8237-9de8041a4c17",
        notifyButton:{enable:true}
      });
      console.log("笨 OneSignal iniciado");
    });
  };
}
</script>
</body>
</html>