<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Criador de Aplicativos com Token e Redirecionador</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: 40px auto;
      background: #121212;
      color: #eee;
      padding: 20px;
      border-radius: 8px;
    }
    input, button {
      padding: 10px;
      margin: 5px 0;
      width: 100%;
      border-radius: 5px;
      border: none;
      font-size: 16px;
    }
    input {
      background: #222;
      color: #eee;
    }
    button {
      background: #4caf50;
      color: white;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.3s;
    }
    button:hover {
      background: #45a049;
    }
    h1 {
      text-align: center;
      margin-bottom: 20px;
      color: #4caf50;
    }
    #tokenList {
      margin-top: 30px;
    }
    .token-item {
      background: #222;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 6px;
      word-break: break-all;
    }
    .token-item strong {
      display: block;
      margin-bottom: 4px;
      color: #81c784;
    }
  </style>
</head>
<body>

<h1>Criar Aplicativo</h1>

<a href="https://alexandre7888.github.io/CodeHUB/documentacao.html"
   class="btn"
   target="_blank"
   rel="noopener noreferrer">
  Abrir Documentação
</a>

<style>
  .btn{
    display:inline-block;
    padding:10px 18px;
    background:#2b6cb0;
    color:#fff;
    text-decoration:none;
    border-radius:8px;
    font-weight:600;
    box-shadow:0 4px 10px rgba(0,0,0,0.08);
  }
  .btn:hover{ opacity:0.95; transform:translateY(-1px); }
</style>

<form id="appForm">
  <input type="text" id="appName" placeholder="Nome do Aplicativo" required />
  <input type="url" id="redirectURL" placeholder="URL do Redirecionador (ex: dashboard.html)" required />
  <button type="submit">Gerar Token e Salvar</button>
</form>

<div id="tokenList">
  <h2>Tokens Criados</h2>
  <div id="tokensContainer">Carregando...</div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
  import { getDatabase, ref, set, get, child, onValue } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";

  // Config do Firebase (separar num firebaseConfig.js e importar aqui se quiser)
  const firebaseConfig = {
    apiKey: "AIzaSyDon4WbCbe4kCkUq-OdLBRhzhMaUObbAfo",
    authDomain: "html-15e80.firebaseapp.com",
    databaseURL: "https://html-15e80-default-rtdb.firebaseio.com",
    projectId: "html-15e80",
    storageBucket: "html-15e80.appspot.com",
    messagingSenderId: "1068148640439",
    appId: "1:1068148640439:web:7cc5bde34f4c5a5ce41b32",
    measurementId: "G-V57KRZ02HJ"
  };

  // Inicializa Firebase
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const auth = getAuth(app);

  const appForm = document.getElementById('appForm');
  const appNameInput = document.getElementById('appName');
  const redirectInput = document.getElementById('redirectURL');
  const tokensContainer = document.getElementById('tokensContainer');

  let userUID = null;

  // Gera token aleatório
  function generateToken(length = 20) {
    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
    let token = '';
    for(let i=0; i<length; i++) {
      token += chars.charAt(Math.floor(Math.random() * chars.length));
    }
    return token;
  }

  // Verifica login
  onAuthStateChanged(auth, user => {
    if (!user) {
      alert("Você precisa estar logado para criar aplicativos.");
      window.location.href = "continuar-conta.html"; // redireciona para login
      return;
    }
    userUID = user.uid;
    loadTokens();
  });

  // Salvar token e dados no Firebase
  async function saveToken(token, appName, redirectURL) {
    try {
      await set(ref(db, `tokens/${token}`), {
        appName,
        redirectURL,
        ownerUID: userUID,
        createdAt: new Date().toISOString()
      });
      alert('Token criado com sucesso!');
      loadTokens();
    } catch(e) {
      alert('Erro ao salvar token: ' + e.message);
    }
  }

  // Carregar tokens do usuário
  function loadTokens() {
    const tokensRef = ref(db, 'tokens');
    onValue(tokensRef, (snapshot) => {
      const data = snapshot.val();
      tokensContainer.innerHTML = '';
      if (!data) {
        tokensContainer.textContent = 'Nenhum token criado ainda.';
        return;
      }
      const tokens = Object.entries(data).filter(([token, val]) => val.ownerUID === userUID);
      if (tokens.length === 0) {
        tokensContainer.textContent = 'Nenhum token criado ainda.';
        return;
      }
      tokens.forEach(([token, val]) => {
        const div = document.createElement('div');
        div.className = 'token-item';
        div.innerHTML = `
          <strong>Token:</strong> ${token}<br/>
          <strong>Aplicativo:</strong> ${val.appName}<br/>
          <strong>Redirecionador:</strong> ${val.redirectURL}
        `;
        tokensContainer.appendChild(div);
      });
    });
  }

  // Quando enviar o formulário
  appForm.addEventListener('submit', e => {
    e.preventDefault();
    const appName = appNameInput.value.trim();
    const redirectURL = redirectInput.value.trim();

    if (!appName || !redirectURL) {
      alert('Preencha todos os campos!');
      return;
    }

    const token = generateToken();
    saveToken(token, appName, redirectURL);

    // Limpa campos
    appNameInput.value = '';
    redirectInput.value = '';
  });
</script>

</body>
</html>