<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Adicionar — ChatRTC</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    body{background:var(--bg);display:flex;align-items:center;justify-content:center;height:100vh;margin:0;font-family:Inter,Arial,sans-serif}
    .sheet{width:94%;max-width:480px;background:var(--card);border-radius:12px;padding:16px;box-shadow:0 10px 30px rgba(10,10,10,0.12)}
    .row{display:flex;gap:12px;align-items:center;margin-bottom:12px}
    .muted{color:var(--muted);font-size:13px}
    .actions{display:flex;gap:8px;justify-content:flex-end;margin-top:8px}
    .radio-row{display:flex;gap:12px;align-items:center;margin-bottom:12px}
    input[type="text"]{flex:1;padding:12px;border-radius:10px;border:1px solid #eee}
  </style>
</head>
<body>
  <div class="sheet" role="main">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
      <strong>Adicionar amigo / entrar em grupo</strong>
      <button id="closeBtn" class="btn small">✕</button>
    </div>

    <div class="radio-row">
      <label><input type="radio" name="type" value="friend" checked> Amigo</label>
      <label><input type="radio" name="type" value="group"> Grupo</label>
    </div>

    <div class="row">
      <input id="targetId" type="text" maxlength="5" placeholder="ID de 5 dígitos (ex: 12345)" />
    </div>

    <div class="muted">Digite o ID (5 dígitos) da pessoa ou do grupo e clique em Adicionar. Para grupos, se ainda não existir, isso apenas adiciona à lista local — o criador deve criar o grupo via Criar grupo.</div>

    <div class="actions">
      <button id="cancel" class="btn">Cancelar</button>
      <button id="add" class="btn primary">Adicionar</button>
    </div>
  </div>

  <script>
    const targetId = document.getElementById('targetId');
    const addBtn = document.getElementById('add');
    const cancel = document.getElementById('cancel');
    const closeBtn = document.getElementById('closeBtn');

    function validId(id){ return /^\d{5}$/.test(id); }

    addBtn.onclick = () => {
      const id = (targetId.value || '').trim();
      if(!validId(id)){ alert('Digite um ID válido de 5 dígitos.'); return; }
      const type = document.querySelector('input[name="type"]:checked').value;
      // For friends we store a simple mapping; for groups we store room metadata placeholder if missing
      if(type === 'friend'){
        try{
          const friends = JSON.parse(localStorage.getItem('friends') || '[]');
          if(!friends.includes(id)) friends.unshift(id);
          localStorage.setItem('friends', JSON.stringify(friends));
        }catch(e){}
        // also add to rooms list for quick open
        localStorage.setItem('roomname:' + id, 'Contato ' + id);
        // store a simple friend entry for UI
        localStorage.setItem('friend:' + id, JSON.stringify({id, added:Date.now()}));
      } else {
        // group: if room metadata exists keep it, otherwise make minimal placeholder so it appears in index
        const exists = localStorage.getItem('room:' + id);
        if(!exists){
          const meta = { owner: null, created: Date.now(), name: 'Grupo ' + id, avatar: null, admins: [], members: [] };
          try{ localStorage.setItem('room:' + id, JSON.stringify(meta)); }catch(e){}
        }
        localStorage.setItem('roomname:' + id, 'Grupo ' + id);
      }
      // return to index and open the chat
      window.location.href = 'index.html?open=' + id;
    };

    cancel.onclick = closeBtn.onclick = () => history.back();
  </script>
</body>
</html>