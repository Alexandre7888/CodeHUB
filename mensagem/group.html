<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Criar Grupo — ChatRTC</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    /* Keep this page compact and mobile-first */
    body{background:var(--bg);display:flex;align-items:center;justify-content:center;height:100vh;margin:0;font-family:Inter,Arial,sans-serif}
    .sheet{width:94%;max-width:480px;background:var(--card);border-radius:12px;padding:16px;box-shadow:0 10px 30px rgba(10,10,10,0.12)}
    .row{display:flex;gap:12px;align-items:center;margin-bottom:12px}
    .sheet input[type="text"]{flex:1;padding:12px;border-radius:10px;border:1px solid #eee}
    .avatar-preview{width:72px;height:72px;border-radius:12px;object-fit:cover;border:1px solid #eee}
    .actions{display:flex;gap:8px;justify-content:flex-end;margin-top:8px}
    .muted{color:var(--muted);font-size:13px}
  </style>
</head>
<body>
  <div class="sheet" role="main">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
      <strong>Criar novo grupo</strong>
      <button id="closeBtn" class="btn small">✕</button>
    </div>

    <div class="row">
      <div style="position:relative">
        <img id="avatarPreview" class="avatar-preview" src="assets/default-avatar.png" alt="avatar">
        <input id="avatarInput" type="file" accept="image/*" hidden>
        <button id="pickAvatar" class="btn small" style="position:absolute;right:-6px;bottom:-6px">✎</button>
      </div>
      <input id="groupName" type="text" placeholder="Nome do grupo (ex: Amigos)" />
    </div>

    <div style="margin-bottom:8px" class="muted">Você será o criador (administrador) desse grupo. Depois poderá convidar pessoas usando o ID de 5 dígitos.</div>

    <div class="actions">
      <button id="cancel" class="btn">Cancelar</button>
      <button id="create" class="btn primary">Criar grupo</button>
    </div>
  </div>

  <script>
    // Basic group creation page logic — stores room metadata in localStorage then returns to index
    const pickAvatar = document.getElementById('pickAvatar');
    const avatarInput = document.getElementById('avatarInput');
    const avatarPreview = document.getElementById('avatarPreview');
    const groupName = document.getElementById('groupName');
    const createBtn = document.getElementById('create');
    const cancelBtn = document.getElementById('cancel');
    const closeBtn = document.getElementById('closeBtn');

    // restore default avatar if user had one
    const storedAvatar = localStorage.getItem('avatarData');
    if(storedAvatar) avatarPreview.src = storedAvatar;

    pickAvatar.onclick = () => avatarInput.click();
    avatarInput.onchange = (e) => {
      const f = e.target.files && e.target.files[0];
      if(!f) return;
      const url = URL.createObjectURL(f);
      avatarPreview.src = url;
      const reader = new FileReader();
      reader.onload = () => { avatarPreview.dataset.preview = reader.result; };
      reader.readAsDataURL(f);
    };

    function makeId(){
      return (Math.floor(10000 + Math.random() * 90000)).toString();
    }

    createBtn.onclick = () => {
      const name = (groupName.value || "").trim() || ("Grupo " + makeId());
      const id = makeId();
      const avatarData = avatarPreview.dataset && avatarPreview.dataset.preview ? avatarPreview.dataset.preview : (localStorage.getItem('avatarData') || null);
      const ownerId = localStorage.getItem('myId') || id;
      const meta = { owner: ownerId, created: Date.now(), name, avatar: avatarData, admins: [ownerId], members: [ownerId] };
      localStorage.setItem('room:' + id, JSON.stringify(meta));
      // store a friendly recent rooms mapping so index can restore
      // Also store a display name for the room
      localStorage.setItem('roomname:' + id, name);
      // Optionally persist chosen avatar for group creation preview as well
      try{ if(avatarData) localStorage.setItem('lastGroupAvatar', avatarData); }catch(e){}
      // go back to app and open the new group via query param
      window.location.href = 'index.html?open=' + id;
    };

    cancelBtn.onclick = closeBtn.onclick = () => { history.back(); };

  </script>
</body>
</html>