<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ChatRTC â€” Mensagens e LigaÃ§Ãµes</title>
  <link rel="stylesheet" href="styles.css" />
  <script type="importmap">
  {
    "imports": {
      "nipplejs": "https://esm.sh/nipplejs@0.9.0",
      "simple-peer": "https://esm.sh/simple-peer@9.11.1"
    }
  }
  </script>
</head>
<body>

<!-- Header -->
<header>
  <div class="brand">ChatRTC</div>
  <div class="right">
    <div id="myId" class="id-badge">ID: ----</div>
    <button id="loginBtn" class="btn primary">ðŸ”µ Login</button>
    <button id="logoutBtn" class="btn danger" style="display:none">ðŸ”´ Sair</button>
  </div>
</header>

<!-- Main app container (mobile-first, single-screen) -->
<main id="app">
  <!-- Left column: roster / groups -->
  <section class="panel" id="sidebar">
    <div class="profile">
      <div class="avatar-wrap">
        <img id="avatarImg" src="assets/default-avatar.png" alt="avatar">
        <input id="avatarInput" type="file" accept="image/*" hidden>
        <button id="changeAvatar" class="btn small">âœŽ</button>
      </div>
      <div class="meta">
        <div id="displayName">Convidado</div>
        <div class="muted" id="statusText">Offline</div>
      </div>
    </div>

    <div class="controls" style="flex-direction:column">
      <div style="display:flex;gap:8px">
        <button id="addContactBtn" class="btn" style="flex:1">Adicionar amigo / grupo</button>
      </div>
      <button id="createBtn" class="btn" style="margin-top:8px;width:100%;">Criar grupo</button>
    </div>

    <div class="list" id="roomsList">
      <div class="muted">Nenhum chat aberto</div>
    </div>
  </section>

  <!-- Right column: messages / call -->
  <section class="panel" id="content">
    <div id="chatHeader" class="chat-header">
      <div style="display:flex;flex-direction:column;gap:6px">
        <div style="display:flex;align-items:center;gap:10px">
          <div id="chatTitle">Sem conversa</div>
          <div id="inviteId" class="muted" style="font-size:13px;background:#f6f8fc;padding:6px 8px;border-radius:8px;margin-left:6px">ID: -----</div>
        </div>
        <div id="chatSub" class="muted" style="font-size:13px">Abra um chat para ver detalhes</div>
      </div>
      <div class="chat-actions" style="display:flex;align-items:center;gap:8px">
        <button id="membersBtn" class="btn" title="Membros">ðŸ‘¥ Membros</button>
        <button id="callBtn" class="btn">ðŸ“ž Chamar</button>
        <button id="videoCallBtn" class="btn">ðŸŽ¥ VÃ­deo</button>
      </div>
    </div>

    <div id="messages" class="messages"></div>

    <div class="composer">
      <input id="msgInput" placeholder="Mensagem..." />
      <input id="fileInput" type="file" accept="image/*,application/*" hidden />
      <button id="attachBtn" class="btn">âž•</button>
      <button id="sendBtn" class="btn primary">Enviar</button>
    </div>

    <div id="callUI" class="call-ui hidden">
      <video id="localVideo" autoplay muted playsinline></video>
      <video id="remoteVideo" autoplay playsinline></video>
      <div class="call-controls">
        <button id="hangupBtn" class="btn danger">Encerrar</button>
        <button id="muteBtn" class="btn">Mudo</button>
        <button id="camBtn" class="btn">CÃ¢mera</button>
      </div>
    </div>
  </section>
  <!-- Members Modal (hidden by default) -->
  <div id="membersModal" style="display:none;position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);width:92%;max-width:420px;background:var(--card);border-radius:12px;padding:12px;box-shadow:0 10px 30px rgba(10,10,10,0.12);z-index:70">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
      <strong>Membros</strong>
      <button id="membersClose" class="btn small">âœ•</button>
    </div>
    <div id="membersList" style="display:flex;flex-direction:column;gap:8px;max-height:42vh;overflow:auto;padding:6px">
      <div class="muted">Nenhum membro</div>
    </div>
    <div style="display:flex;justify-content:space-between;gap:8px;margin-top:10px">
      <button id="inviteCopy" class="btn">Copiar ID do convite</button>
      <button id="reportGroup" class="btn danger">Denunciar grupo</button>
    </div>
  </div>

  <!-- Create Group Modal (hidden by default) -->
  <div id="groupModal" style="display:none;position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);width:92%;max-width:420px;background:var(--card);border-radius:12px;padding:16px;box-shadow:0 10px 30px rgba(10,10,10,0.12);z-index:60">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
      <strong>Criar novo grupo</strong>
      <button id="groupClose" class="btn small">âœ•</button>
    </div>
    <div style="display:flex;gap:12px;align-items:center;margin-bottom:8px">
      <div style="position:relative;width:64px;height:64px">
        <img id="groupAvatarPreview" src="assets/default-avatar.png" alt="avatar" style="width:64px;height:64px;border-radius:12px;object-fit:cover;border:1px solid #eee">
        <input id="groupAvatarInput" type="file" accept="image/*" hidden>
        <button id="groupAvatarBtn" class="btn small" style="position:absolute;right:-6px;bottom:-6px">âœŽ</button>
      </div>
      <input id="groupNameInput" placeholder="Nome do grupo" style="flex:1;padding:10px;border-radius:10px;border:1px solid #eee">
    </div>
    <div style="display:flex;justify-content:flex-end;gap:8px">
      <button id="groupCreateCancel" class="btn">Cancelar</button>
      <button id="groupCreateConfirm" class="btn primary">Criar</button>
    </div>
  </div>

</main>

<!-- Hidden: API de autenticaÃ§Ã£o fornecida pelo usuÃ¡rio -->
<script src="https://code.codehub.ct.ws/API/userKeyAPI.js"></script>

<!-- Firebase (compat) - replace config in app.js when ready -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

<!-- App modules -->
<script type="module" src="app.js"></script>
</body>
</html>