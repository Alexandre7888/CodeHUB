<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>MúsicaHUB</title>

  <style>
    body { 
      font-family: Arial; 
      padding: 20px; 
      background: #121212; 
      color: white;
    }
    h1 { color: #1DB954; }
    input { 
      padding: 10px; 
      width: 260px; 
      border-radius: 8px;
      border: none;
      outline: none;
    }
    button { 
      padding: 10px 14px; 
      cursor: pointer; 
      background: #1DB954; 
      border: none;
      border-radius: 8px;
      color: #fff;
      font-weight: bold;
    }
    #results img { width: 60px; border-radius: 6px; }
    .track {
      display: flex;
      gap: 12px;
      margin: 10px 0;
      cursor: pointer;
      background: #1E1E1E;
      padding: 12px;
      border-radius: 10px;
    }
    iframe {
      margin-top: 10px;
      border-radius: 10px;
    }
  </style>
</head>

<body>

<h1>MúsicaHUB</h1>

<input id="search" placeholder="Buscar música..." />
<button onclick="searchMusic()">Buscar</button>

<h3>Resultados da busca:</h3>
<div id="results"></div>

<h3>Player:</h3>
<iframe id="ytplayer" width="360" height="200" allowfullscreen></iframe>

<h3>Música tocando no seu Spotify:</h3>
<button onclick="getCurrent()">Ver música tocando</button>
<div id="current"></div>


<script>
// ===============================
// CONFIGURAÇÕES IMPORTANTES
// ===============================

// YouTube 
const YT_KEY = "AIzaSyDrZpjsWCjkqLCcH_pfs4X7432Db-Rxa4g";

//  Spotify 
const SPOTIFY_CLIENT_ID = "66ec7b6fad70470595619345176e3bd3";

//  direcionador
const REDIRECT_URI = "https://code.codehub2025.ct.ws/musicaHUB.html";

let spotifyToken = "";


// ===============================
// LOGIN AUTOMÁTICO SPOTIFY
// ===============================
function loginSpotify() {
  const url =
    "https://accounts.spotify.com/authorize" +
    "?response_type=token" +
    "&client_id=" + SPOTIFY_CLIENT_ID +
    "&redirect_uri=" + encodeURIComponent(REDIRECT_URI) +
    "&scope=user-read-playback-state user-read-currently-playing";

  window.location = url;
}

// Captura o token depois do login
if (window.location.hash.includes("access_token")) {
  spotifyToken = window.location.hash.split("access_token=")[1].split("&")[0];
}


// ===============================
// BUSCAR MÚSICA NO SPOTIFY
// ===============================
async function searchMusic() {
  const q = document.getElementById("search").value;
  if (!q) return;

  if (!spotifyToken) return loginSpotify();

  const res = await fetch(
    "https://api.spotify.com/v1/search?q=" + encodeURIComponent(q) + "&type=track",
    { headers: { Authorization: "Bearer " + spotifyToken } }
  );

  const data = await res.json();

  const tracks = data.tracks.items;
  const div = document.getElementById("results");
  div.innerHTML = "";

  tracks.forEach(t => {
    const el = document.createElement("div");
    el.className = "track";

    el.innerHTML = `
      <img src="${t.album.images[2].url}">
      <div>
        <b>${t.name}</b><br>
        ${t.artists[0].name}
      </div>
    `;

    el.onclick = () => searchYouTube(t.name + " " + t.artists[0].name);
    div.appendChild(el);
  });
}


// ===============================
// BUSCAR VÍDEO NO YOUTUBE
// ===============================
async function searchYouTube(query) {
  const url =
    `https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(query)}&key=${YT_KEY}`;

  const res = await fetch(url);
  const data = await res.json();

  const videoId = data.items[0].id.videoId;

  document.getElementById("ytplayer").src =
    "https://www.youtube.com/embed/" + videoId;
}


// ===============================
// VER MÚSICA TOCANDO NO SPOTIFY
// ===============================
async function getCurrent() {
  if (!spotifyToken) return loginSpotify();

  const res = await fetch(
    "https://api.spotify.com/v1/me/player/currently-playing",
    { headers: { Authorization: "Bearer " + spotifyToken } }
  );

  const data = await res.json();

  if (!data || !data.item) {
    document.getElementById("current").innerHTML = "Nenhuma música tocando.";
    return;
  }

  document.getElementById("current").innerHTML = `
    <b>${data.item.name}</b><br>
    ${data.item.artists[0].name}<br>
    <img src="${data.item.album.images[2].url}" width="80">
  `;
}

</script>

</body>
</html>