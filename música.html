<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Spotify + YouTube Player</title>

<style>
body{
  background:#000;
  color:#fff;
  font-family:Arial;
  padding:20px;
}
button{
  background:#1db954;
  border:none;
  padding:12px 20px;
  border-radius:25px;
  font-weight:bold;
  cursor:pointer;
}
.song{
  display:flex;
  gap:10px;
  background:#111;
  margin:10px 0;
  padding:10px;
  border-radius:10px;
  cursor:pointer;
}
.song img{width:50px;border-radius:6px}
</style>
</head>

<body>

<button onclick="login()">Login Spotify.</button>
<div id="results"></div>
<div id="player"></div>

<script src="https://www.youtube.com/iframe_api"></script>
<script>
/* CONFIG */
const CLIENT_ID = "66ec7b6fad70470595619345176e3bd3";
const REDIRECT_URI = "https://code.codehub2025.ct.ws/m√∫sica";
const SCOPES = "user-top-read";
const YT_KEY = "AIzaSyDQ5kbZin0YzoNgpxNkeG45M6PMXCy9pgI";

let player;

/* LOGIN */
function login(){
  location.href =
    "https://accounts.spotify.com/authorize" +
    "?response_type=token" +
    "&client_id=" + CLIENT_ID +
    "&scope=" + encodeURIComponent(SCOPES) +
    "&redirect_uri=" + encodeURIComponent(REDIRECT_URI);
}

/* TOKEN */
if(location.hash){
  const p = new URLSearchParams(location.hash.substring(1));
  localStorage.setItem("token", p.get("access_token"));
  localStorage.setItem("exp", Date.now() + p.get("expires_in")*1000);
  location.hash="";
}

const token = localStorage.getItem("token");
const exp = localStorage.getItem("exp");

if(token && Date.now() < exp){
  loadTop();
}

/* SPOTIFY */
async function loadTop(){
  const r = await fetch(
    "https://api.spotify.com/v1/me/top/tracks?limit=10",
    { headers:{ Authorization:"Bearer "+token } }
  );
  const d = await r.json();
  results.innerHTML="";
  d.items.forEach(t=>{
    const div=document.createElement("div");
    div.className="song";
    div.innerHTML=`
      <img src="${t.album.images[0].url}">
      <div><b>${t.name}</b><br>${t.artists[0].name}</div>
    `;
    div.onclick=()=>play(t.name+" "+t.artists[0].name);
    results.appendChild(div);
  });
}

/* YOUTUBE */
async function play(q){
  const y = await fetch(
    `https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&maxResults=1&q=${encodeURIComponent(q)}&key=${YT_KEY}`
  );
  const id = (await y.json()).items[0].id.videoId;
  player.loadVideoById(id);
}

function onYouTubeIframeAPIReady(){
  player = new YT.Player("player",{height:"0",width:"0"});
}
</script>

</body>
</html>