<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Criador de Aplicativos com Token e Redirecionador</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 40px auto;
      background: #121212;
      color: #eee;
      padding: 20px;
      border-radius: 8px;
    }

    input, button {
      padding: 10px;
      margin: 5px 0;
      width: 100%;
      border-radius: 5px;
      border: none;
      font-size: 16px;
      box-sizing: border-box;
    }

    input {
      background: #222;
      color: #eee;
    }

    button {
      background: #4caf50;
      color: white;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.3s;
    }

    button:hover {
      background: #45a049;
    }

    h1, h2 {
      text-align: center;
      color: #4caf50;
    }

    .section {
      background: #1a1a1a;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    }

    .token-item {
      background: #222;
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 6px;
      word-break: break-all;
    }

    .api-url {
      color: #64b5f6;
      background: #1a1a1a;
      padding: 8px;
      border-radius: 4px;
      border: 1px solid #333;
      margin-top: 10px;
    }

    .copy-btn {
      background: #ff9800;
      margin-top: 10px;
    }

    .copy-btn:hover {
      background: #f57c00;
    }

    .doc-btn {
      display: inline-block;
      padding: 10px 18px;
      background: #2b6cb0;
      color: #fff;
      text-decoration: none;
      border-radius: 8px;
      font-weight: 600;
      margin-bottom: 20px;
    }
  </style>
</head>

<body>

<h1>Criador de Aplicativos</h1>

<a href="https://alexandre7888.github.io/CodeHUB/documentacao.html"
   class="doc-btn"
   target="_blank"
   rel="noopener noreferrer">
  Abrir Documentação
</a>

<div class="section">
  <h2>Criar Novo Aplicativo</h2>
  <form id="appForm">
    <input type="text" id="appName" placeholder="Nome do Aplicativo" required />
    <input type="url" id="redirectURL" placeholder="URL do Redirecionador" required />
    <button type="submit">Gerar Token e Salvar</button>
  </form>
</div>

<div class="section">
  <h2>APIs Criadas</h2>
  <div id="tokensContainer">Carregando...</div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
  import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDon4WbCbe4kCkUq-OdLBRhzhMaUObbAfo",
    authDomain: "html-15e80.firebaseapp.com",
    databaseURL: "https://html-15e80-default-rtdb.firebaseio.com",
    projectId: "html-15e80",
    storageBucket: "html-15e80.appspot.com",
    messagingSenderId: "1068148640439",
    appId: "1:1068148640439:web:7cc5bde34f4c5a5ce41b32"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const auth = getAuth(app);

  const appForm = document.getElementById("appForm");
  const tokensContainer = document.getElementById("tokensContainer");

  let userUID = null;

  function generateToken(length = 24) {
    const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
    let token = "";
    for (let i = 0; i < length; i++) {
      token += chars.charAt(Math.floor(Math.random() * chars.length));
    }
    return token;
  }

  onAuthStateChanged(auth, user => {
    if (!user) {
      alert("Você precisa estar logado.");
      window.location.href = "https://alexandre7888.github.io/CodeHUB/auth";
      return;
    }
    userUID = user.uid;
    loadTokens();
  });

  appForm.addEventListener("submit", e => {
    e.preventDefault();
    const appName = document.getElementById("appName").value.trim();
    const redirectURL = document.getElementById("redirectURL").value.trim();
    if (!appName || !redirectURL) return;

    const token = generateToken();

    set(ref(db, "tokens/" + token), {
      appName,
      redirectURL,
      ownerUID: userUID,
      createdAt: new Date().toISOString()
    });

    appForm.reset();
  });

  function loadTokens() {
    onValue(ref(db, "tokens"), snap => {
      tokensContainer.innerHTML = "";
      const data = snap.val();
      if (!data) {
        tokensContainer.textContent = "Nenhuma API criada ainda.";
        return;
      }

      Object.entries(data).forEach(([token, val]) => {
        if (val.ownerUID !== userUID) return;

        const div = document.createElement("div");
        div.className = "token-item";
        div.innerHTML = `
          <strong>Aplicativo:</strong> ${val.appName}<br>
          <strong>Token:</strong> ${token}<br>
          <strong>Redirecionador:</strong> ${val.redirectURL}
          <div class="api-url">
            https://code.codehub.ct.ws/API/continuar-conta?token=${token}
          </div>
        `;

        tokensContainer.appendChild(div);
      });
    });
  }
</script>

</body>
</html>
